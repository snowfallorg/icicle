Icicle Configuration
===
The Icicle installer is configured using YAML files, with a basic configuration looking like this:

```yml
---
distribution_name: SnowflakeOS
distribution_logo: branding/snowflakeos/snowflakeos.svg
branding: snowflakeos
internet_check_url: http://nmcheck.gnome.org/check_network_status.txt
default_hostname: snowflakeos
choices:
- !configuration
  file: basic.yml
- !configuration
  file: advanced.yml
- live
```


### `distribution_name`
The name of the distribution. This is used in the installers title and welcome screen.

### `distribution_logo`
The path to the distribution logo. Currently unused.

### `branding`
The name of the branding directory. This is used to find the branding files for the installing slideshow.

### `internet_check_url`
The url to ping to check for an internet connection.

### `default_hostname`
The default hostname to use for the installation.

### `choices`
A list of configuration options to load, each option can either be a `!configuration` or `live`.

A `!configuration` option must specify a `file` to load, which is a local path to an installation configuration file. The `live` option adds a `Try {distribution name} live` option that simply quits the installer and allows the user to test the desktop.

## Installation Configurations

Installation configurations specify what steps of the installer are used. An example configuration can be found in [basic.yml](./basic.yml.in) and [basic](./basic).

```yml
---
config_name: "Basic Installation"
config_logo: emoji-symbols-symbolic
config_id: basic
steps:
- welcome
- keyboard
- location
- !user
- partitioning
- summary
```

### `config_name`
The name of the configuration option. Show on the welcome screen.

### `config_logo`
The icon name to use for the configuration option. Show on the welcome screen.

### `config_id`
id of the configuration option, should be the same as the name of this file.

### `steps`
A list of steps to use in the installer. Available options are:
- `welcome`
    
    The welcome screen that allows a user to choose a language. 
- `keyboard`

    The keyboard layout selection screen.

- `location`

    Location and time selection screen.

- `!user`

    User creation screen. This is a special step that can be configured using the `!user` tag.

    ```yml
    - !user
      root: true
      hostname: true
    ```

    The `root` option specifies whether there should be an option to set a root password on the user configuration screen.

    The `hostname` option specifies whether there should be an option to set a hostname on the user configuration screen.

- `partitioning`

    The partitioning screen. This screen allows a user to either choose a whole disk for the installation, or to manually partition the disk with GParted and select partitions to use.

- `summary`

    This screen provides a summary of the options selected to that the user can review their choices before installing.

- `list`

    The screen provides a list of options to choose from. This is a special step that can be completely configured using the `!list` tag.


    ```yml
    - !list
      multiple: true
      required: false
      title: "Extra Package Managers"
      id: PACKAGEMANAGERS
      choices:
        - Flatpak:
            description: "Enable Flatpak support"
            config: |-
              # Enable flatpak support
              services.flatpak.enable = true;
        - AppImage:
            description: "Enable AppImage support by installing the \"appimage-run\" package. For AppImages to work, you must run them with the \"appimage-run\" command."
            packages:
            - appimage-run
    ```

    - `multiple`

        Specifies whether the user can select multiple options or not.

    - `required`

        Specifies whether the user must select at least one option.

    - `title`

        The title shown on top of the list.

    - `id`

        The id of the list, the `@id@` in all configuration files will be replaced with the configuration snippet from the `config` option.

    - `choices`

        A list of options that the user can choose from.

        - `description`

            The description of the option.

        - `config`

            The configuration snippet that will be added to a configuration file if the option is selected.

        - `packages`

            A list of packages that will be installed if the option is selected.

## NixOS Configurations

With each installation configuration, a set of configuration files including a `configuration.nix` file must be placed in a directory called `/etc/icicle/{config_id}`. The `configuration.nix` file is used to configure the installed system. The final configuration files are generated by replacing the `@OPTION@` tags in the configuration files with the options selected by the user.

Configuration snippets:
- `@BOOTLOADRER@` - Bootloader
- `@NETWORK@` - Network configuration
- `@TIMEZONE@` - Timezone
- `@LOCALE@` - Localization
- `@KEYBOARD@` - Keyboard layout
- `@AUTOLOGIN@` - Autologin config
- `@PACKAGES@` - Packages to install
- `@STATEVERSION@` - NixOS version found by running `nixos-version`

Standalone values:
- `@HOSTNAME@` - Hostname
- `@USERNAME@` - Username
- `@FULLNAME@` - A user's full name
